<?xml version="1.0" encoding="utf-8"?>
<InstructionData xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <DateTime>134034561562181108</DateTime>
  <GameVersion>0.2.5924.26069</GameVersion>
  <Title>Ingot Selection Interface</Title>
  <Description>Item scroller, Quantity selection, GO button and two displays for displaying request total and remainder. Prevents releasing more stacks than a silo contains.â€‹</Description>
  <Author>MrDrummer25</Author>
  <WorkshopFileHandle>0</WorkshopFileHandle>
  <Instructions>alias IngotSiloDb d0
alias ItemDial d1
alias QuantityDial d2
# alias RequestQtyDisplay d3
# alias RemainingQtyDisplay d3
alias SubmitButton d3
alias LabelDisplay d4
alias InterlockMemory d5
# Setting will be hash, used by display

alias RequestCode r11
alias IngotStackIndex r12
alias QuantityDialSetting r13
alias SelectedIngotHash r14
alias ItemDialSetting r15

define DESTINATIONID 0

# SIZE, TYPE, DESTINATIONID

define IngotIndexSkip 3 # Stack indexes per ingot (3: prefab hash, silo hash, string label

Start:
move ItemDialSetting -1
get r0 IngotSiloDb 511 # Get total number of ingots to check
s ItemDial Mode r0 # Set max dial value

MainLoop:
yield

l r0 ItemDial Setting

l QuantityDialSetting QuantityDial Setting

bneal r0 ItemDialSetting ChangeItem # != 0 ( &gt; 0 )
beqzal ItemDialSetting ClearItem # = 0
l r0 SubmitButton Setting
bnezal r0 RequestItem # != 0 ( &gt; 0 )

j MainLoop

ChangeItem:
s LabelDisplay Color Color.White

# TODO: REMOVE THIS
s InterlockMemory Setting 0
move ItemDialSetting r0
s LabelDisplay On 1
sub r0 ItemDialSetting 1 # convert to 0 based index
mul IngotStackIndex r0 IngotIndexSkip
get SelectedIngotHash IngotSiloDb IngotStackIndex # Get prefab hash
add IngotStackIndex IngotStackIndex 1
get r0 IngotSiloDb IngotStackIndex # Get silo hash
lbn r1 HASH("StructureSDBSilo") r0 Quantity Sum
s QuantityDial Mode r1
s QuantityDial Setting 0
add IngotStackIndex IngotStackIndex 1
get r0 IngotSiloDb IngotStackIndex # Get string label
s LabelDisplay On 1
s LabelDisplay Mode DisplayMode.String
s LabelDisplay Setting r0

j ra # Jump back to main loop

ClearItem:
s LabelDisplay On 0
s QuantityDial Setting 0
j ra

RequestItem:
move RequestCode QuantityDialSetting
mul RequestCode RequestCode 100 # Max 100 items per request
add RequestCode RequestCode ItemDialSetting
mul RequestCode RequestCode 100 # Shift left 2 decimal places
add RequestCode RequestCode DESTINATIONID # Add destination ID (0 for printer)

s LabelDisplay Color Color.Orange # Indicate Waiting
InterlockWaitLoop:
yield
l r0 InterlockMemory Setting
bnez r0 InterlockWaitLoop # Wait for interlock to clear
s InterlockMemory Setting RequestCode # Write request code to interlock memory
s LabelDisplay Color Color.Green # Indicate request sent

j ra</Instructions>
</InstructionData>
