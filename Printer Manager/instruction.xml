<?xml version="1.0" encoding="utf-8"?>
<InstructionData xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <DateTime>134028396729732739</DateTime>
  <GameVersion>0.2.5914.26037</GameVersion>
  <Title>Printer Manager</Title>
  <Description>Identifies ingot requirements, accepts a "master" chip to clone instructions from, and handles accepting itemsâ€‹</Description>
  <Author>MrDrummer25</Author>
  <WorkshopFileHandle>0</WorkshopFileHandle>
  <Instructions>alias ReagentDb d0
alias Printer d1
alias ReagentCount r11
alias DialSetting r12
alias ReagentExpectedQty r13
alias ReagentActualQty r14
alias ReagentDbIndex r15

Start:
  get ReagentCount ReagentDb 511 # Get total number of ingots to check
  jal CheckContents

MainLoop:
  yield

  l r0 Printer ImportCount #has some metal been put in the printer?
  beqzal r0 CheckContents
j MainLoop

CheckContents:
  clr db # clear stack
  move sp 0 # stack pointer to 0
  s Printer ClearMemory 1 # clear Printer internal memory (Import Count)
  s db Setting 0 # clear config option
  move ReagentDbIndex 0

ReagentLoop:
bgt ReagentDbIndex ReagentCount ra
  get r0 ReagentDb ReagentDbIndex
  add ReagentDbIndex ReagentDbIndex 1
  get ReagentExpectedQty ReagentDb ReagentDbIndex
  add ReagentDbIndex ReagentDbIndex 1
  lr ReagentActualQty Printer Contents r0
  rmap r0 Printer r0
  # TODO: Write to logic sorter

bge ReagentActualQty ReagentExpectedQty NextStep #if we have enough, check next one.
  push r0
  sub r0 ReagentExpectedQty ReagentActualQty
  push r0

NextStep:
j ReagentLoop
# j MainLoop # Use this instead for a single check
</Instructions>
</InstructionData>
